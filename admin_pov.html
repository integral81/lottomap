<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotto POV Admin - ìˆ˜ê¸° ë“±ë¡ ë„êµ¬</title>
    <script>
        function handleSDKError() {
            console.error('Kakao Maps SDK Load Failed');
            alert('ì¹´ì¹´ì˜¤ ì§€ë„ SDKë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²° ë° ë„ë©”ì¸ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            // Even if SDK fails, try to render the list
            if (typeof renderShopList === 'function') renderShopList();
        }
    </script>
    <script type="text/javascript"
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=a6b27b6dab16c7e3459bb9589bf1269d&libraries=services,roadview"
        onerror="handleSDKError()"></script>
    <style>
        :root {
            --primary: #d32f2f;
            --sidebar-width: 350px;
            --header-height: 60px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #f0f2f5;
        }

        header {
            height: var(--header-height);
            background: #333;
            color: white;
            display: flex;
            align-items: center;
            padding: 0 20px;
            justify-content: space-between;
        }

        header h1 {
            font-size: 18px;
        }

        main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        #sidebar {
            width: var(--sidebar-width);
            background: white;
            border-right: 1px solid #ddd;
            overflow-y: auto;
            padding: 10px;
        }

        .shop-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            border-radius: 6px;
            margin-bottom: 5px;
        }

        .shop-item:hover {
            background: #f5f5f5;
        }

        .shop-item.active {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .shop-name {
            font-weight: bold;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .shop-addr {
            font-size: 12px;
            color: #666;
        }

        .win-count {
            display: inline-block;
            background: var(--primary);
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-top: 4px;
        }

        #content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        #viewer-container {
            flex: 1;
            display: flex;
            gap: 10px;
            padding: 10px;
        }

        #map {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        #roadview {
            flex: 2;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        #control-panel {
            height: 250px;
            background: white;
            border-top: 1px solid #ddd;
            padding: 15px;
            display: flex;
            gap: 20px;
        }

        .control-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-group h3 {
            font-size: 14px;
            margin-bottom: 5px;
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }

        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
        }

        .input-row label {
            width: 60px;
            color: #555;
        }

        .input-row input {
            flex: 1;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #result-area {
            flex: 1.5;
            background: #2d2d2d;
            color: #a9dc76;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            position: relative;
            overflow-y: auto;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 12px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .copy-btn:hover {
            background: #45a049;
        }

        .btn-update {
            padding: 8px 16px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
        }

        .btn-update:hover {
            background: #1976d2;
        }
    </style>
</head>

<body>
    <header>
        <h1>ğŸ° POV ê´€ë¦¬ ì–´ë“œë¯¼ (Admin Template)</h1>
        <div>
            <span id="status-text" style="font-size: 13px; opacity: 0.8;">ëŒ€ìƒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
        </div>
    </header>

    <main>
        <div id="sidebar">
            <div
                style="padding: 10px; font-size: 13px; font-weight: bold; color: #333; border-bottom: 1px solid #eee; margin-bottom: 10px;">
                POI ëˆ„ë½ ë¦¬ìŠ¤íŠ¸ (<span id="missing-count">0</span>)
            </div>
            <div id="shop-list"></div>
        </div>

        <div id="content">
            <div id="viewer-container">
                <div id="map"></div>
                <div id="roadview"></div>
            </div>

            <div id="control-panel">
                <div class="control-group">
                    <h3>POV ì‹¤ì‹œê°„ ì¢Œí‘œ</h3>
                    <div class="input-row">
                        <label>Lat</label>
                        <input type="text" id="cur-lat" readonly>
                    </div>
                    <div class="input-row">
                        <label>Lng</label>
                        <input type="text" id="cur-lng" readonly>
                    </div>
                    <button class="btn-update" onclick="syncMapToRV()">ë¡œë“œë·° ìœ„ì¹˜ë¡œ ì§€ë„ ì´ë™</button>
                </div>

                <div class="control-group">
                    <h3>POV íŒŒë¼ë¯¸í„°</h3>
                    <div class="input-row">
                        <label>PanoID</label>
                        <input type="text" id="rv-pano" readonly>
                    </div>
                    <div class="input-row">
                        <label>Pan</label>
                        <input type="text" id="rv-pan">
                    </div>
                    <div class="input-row">
                        <label>Tilt</label>
                        <input type="text" id="rv-tilt">
                    </div>
                    <div class="input-row">
                        <label>Zoom</label>
                        <input type="text" id="rv-zoom">
                    </div>
                </div>

                <div class="control-group" style="flex: 1.5;">
                    <h3>ë“±ë¡ ì½”ë“œ ìƒì„±</h3>
                    <div id="result-area">
                        <button class="copy-btn" onclick="copyCode()">ë³µì‚¬</button>
                        <pre id="code-output">// ìƒì ì„ ì„ íƒí•´ì£¼ì„¸ìš”</pre>
                    </div>
                    <!-- New Button for marking as registered -->
                    <button class="btn-update" style="margin-top:10px; background: #4caf50; width: 100%;"
                        onclick="markAsRegistered()">ì´ ìƒì  ë“±ë¡ ì™„ë£Œ (ë¦¬ìŠ¤íŠ¸ì—ì„œ ì œê±°)</button>
                    <button onclick="resetRegistered()"
                        style="margin-top:10px; font-size:11px; background:none; border:none; color:#999; text-decoration:underline; cursor:pointer;">ë“±ë¡
                        ì™„ë£Œ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        let map, rv, rvClient, marker;
        let currentShop = null;
        let allMissingShops = [

            {
                "name": "ì˜¤ì¼€ì´ìƒì‚¬",
                "address": "ì„œìš¸ ì„œì´ˆêµ¬ ì‹ ë°˜í¬ë¡œ 176 ì„¼íŠ¸ëŸ´ì‹œí‹°ë‚´100í˜¸ë§¤ì ",
                "wins": 8,
                "lat": 37.5039351769908,
                "lng": 127.002413006799,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë°±í™”ì ",
                "address": "ê²½ê¸° íŒŒì£¼ì‹œ ê¸ˆì´Œ2ë™ 329-135",
                "wins": 7,
                "lat": 37.3984223865984,
                "lng": 126.726256461664,
                "has_coords": true
            },
            {
                "name": "í–‰ë³µí•œì‚¬ëŒë“¤ (í¥ë¶€ë„¤)",
                "address": "ê²½ê¸° ê´‘ì£¼ì‹œ ê²½ì¶©ëŒ€ë¡œ 763",
                "wins": 5,
                "lat": 37.3555798712105,
                "lng": 127.32540015887,
                "has_coords": true
            },
            {
                "name": "ë…¸ë‹¤ì§€ë³µê¶Œë°©",
                "address": "ê²½ê¸° ìš©ì¸ì‹œ ì²˜ì¸êµ¬ ê¸ˆë ¹ë¡œ 130",
                "wins": 5,
                "lat": 37.2351637037009,
                "lng": 127.210500032181,
                "has_coords": true
            },
            {
                "name": "ì•Œë¦¬ë°”ì´(ë‚˜ì£¼ì )",
                "address": "ì „ë‚¨ ë‚˜ì£¼ì‹œ ë‚˜ì£¼ë¡œ 142 ì•Œë¦¬ë°”ì´",
                "wins": 5,
                "lat": 35.0313297380285,
                "lng": 126.717157991346,
                "has_coords": true
            },
            {
                "name": "ë…¸ë‹¤ì§€ë³µê¶Œë°©",
                "address": "ê²½ê¸° ì‹œí¥ì‹œ ëŒ€ì•¼ë™ 345-16 1ì¸µìƒê°€",
                "wins": 5,
                "lat": 37.448416258611,
                "lng": 126.791926293123,
                "has_coords": true
            },
            {
                "name": "ì˜¤ì¼€ì´ìƒì‚¬",
                "address": "ì„œìš¸ ì„œì´ˆêµ¬ ë°˜í¬ë™ 19-3ë²ˆì§€ ì„¼íŠ¸ëŸ´ì‹œí‹°ë‚´100í˜¸ë§¤ì ",
                "wins": 5,
                "lat": 37.5043641148563,
                "lng": 127.003620888061,
                "has_coords": true
            },
            {
                "name": "ì˜¤ì²œì–µë³µê¶Œë°©",
                "address": "ê´‘ì£¼ ì„œêµ¬ í™”ì •ë™ 782-14",
                "wins": 5,
                "lat": 35.1529734232587,
                "lng": 126.88072111789,
                "has_coords": true
            },
            {
                "name": "ë¯¸ë‚˜ì‹í’ˆ(ë¡œë˜íŒë§¤ì )",
                "address": "ì„œìš¸ ê°•ì„œêµ¬ ë°©í™”ë™ 484-23",
                "wins": 5,
                "lat": 37.5735042394953,
                "lng": 126.810684180076,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œì „ë¬¸ì ",
                "address": "ì¸ì²œ ë¶€í‰êµ¬ ì²­ì²œë™ 236-20",
                "wins": 5,
                "lat": 37.5038435469501,
                "lng": 126.715130703363,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œëª…ë‹¹",
                "address": "ì¶©ë‚¨ ê³µì£¼ì‹œ ì‹ ê´€ë™ 585-12",
                "wins": 5,
                "lat": 36.471840773738,
                "lng": 127.133136987861,
                "has_coords": true
            },
            {
                "name": "ì˜í™”ìœ í†µ(1ë“±ë³µê¶Œë°©)",
                "address": "ìš¸ì‚° ë‚¨êµ¬ ë‹¬ë™ 758ì‚¼ì„±ì•„íŒŒíŠ¸ìƒê°€204-101",
                "wins": 5,
                "lat": 35.5338146134567,
                "lng": 129.322041642891,
                "has_coords": true
            }
            ,

            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ê´€ì•…êµ¬ ë‚¨ë¶€ìˆœí™˜ë¡œ 1739-9",
                "wins": 6,
                "lat": 37.4828013647636,
                "lng": 126.943500830574,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ê´€ì•…êµ¬ ì€ì²œë¡œ 40-1",
                "wins": 4,
                "lat": 37.4860180512095,
                "lng": 126.939843355048,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ë¶ í¬í•­ì‹œ ë¶êµ¬ ì¥ëŸ‰ë¡œ140ë²ˆê¸¸ 9",
                "wins": 3,
                "lat": 36.0807952248086,
                "lng": 129.396033290327,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê°•ì› ì›ì£¼ì‹œ í‰ì›ë¡œ 23",
                "wins": 3,
                "lat": 37.348928526007,
                "lng": 127.952670718954,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì¶©ë¶ ì¦í‰êµ° ì¦í‰ì ì¤‘ë™ë¦¬ 15-3",
                "wins": 3,
                "lat": 36.7839438665052,
                "lng": 127.580889865585,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ê´€ì•…êµ¬ ë´‰ì²œë™(ì€ì²œë™) 926-25",
                "wins": 3,
                "lat": 37.4827911801255,
                "lng": 126.943494054423,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ì„±ë™êµ¬ ìš©ë‹µë™ 14-1",
                "wins": 3,
                "lat": 37.5644409842752,
                "lng": 127.053859448354,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì „ë‚¨ ì—¬ìˆ˜ì‹œ êµë™ 448-2",
                "wins": 3,
                "lat": 34.7399222761121,
                "lng": 127.734331898863,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì¸ì²œ ì„œêµ¬ ì„ë‚¨ë™ 586-2",
                "wins": 3,
                "lat": 37.5030148858875,
                "lng": 126.670726575652,
                "has_coords": true
            },
            {
                "name": "í•™ë™ë³µê¶Œë‚˜ë¼",
                "address": "ì „ë‚¨ ì—¬ìˆ˜ì‹œ í¥êµ­ë¡œ 6",
                "wins": 3,
                "lat": 34.7635691680105,
                "lng": 127.663464230519,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ê¸° ì˜¤ì‚°ì‹œ ì„±í˜¸ëŒ€ë¡œ93ë²ˆê¸¸ 27",
                "wins": 2,
                "lat": 37.1513170334452,
                "lng": 127.071478824279,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ê¸° ë‚¨ì–‘ì£¼ì‹œ ë„ë†ë¡œ 13",
                "wins": 2,
                "lat": 37.6072364396042,
                "lng": 127.156816291708,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì¶©ë¶ ì¦í‰êµ° ì¤‘ì•™ë¡œ 199-1",
                "wins": 2,
                "lat": 36.7839561792603,
                "lng": 127.580914940543,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ê¸° í¬ì²œì‹œ ì†Œí˜ì ì£½ì—½ì‚°ë¡œ35ë²ˆê¸¸ 1",
                "wins": 2,
                "lat": 37.8267398343763,
                "lng": 127.15268359735,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ì„±ë™êµ¬ ìš©ë‹µì¤‘ì•™15ê¸¸ 12-1",
                "wins": 2,
                "lat": 37.5644524282652,
                "lng": 127.053856513732,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ëŒ€ì „ ëŒ€ë•êµ¬ ì‹ íƒ„ì§„ë™ë¡œ 1",
                "wins": 2,
                "lat": 36.4475864451575,
                "lng": 127.429908883694,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì „ë‚¨ ëª©í¬ì‹œ ì˜¥ì•”ë™ 1153-5 103í˜¸ ë³µê¶Œë‚˜ë¼",
                "wins": 2,
                "lat": 34.8076009918631,
                "lng": 126.437162197145,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì¶©ë‚¨ ê³„ë£¡ì‹œ ì—„ì‚¬ë©´ ì—„ì‚¬ë¦¬ 184-4",
                "wins": 2,
                "lat": 36.2890793367871,
                "lng": 127.241625850133,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê°•ì› ì‚¼ì²™ì‹œ ë„ê³„ì ë„ê³„ë¦¬ 393-1",
                "wins": 2,
                "lat": 37.2349037505995,
                "lng": 129.044671351744,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì „ë¶ êµ°ì‚°ì‹œ ëŒ€ì•¼ë©´ ì§€ê²½ë¦¬ 731-2",
                "wins": 2,
                "lat": 35.946735046441,
                "lng": 126.810382525551,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì¸ì²œ ì¤‘êµ¬ ì‹ í¥ë™2ê°€ 16-37",
                "wins": 2,
                "lat": 37.4673557278352,
                "lng": 126.63370998796,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ê¸° í¬ì²œì‹œ ì†Œí˜ì ì´ê°€íŒ”ë¦¬ 309-1",
                "wins": 2,
                "lat": 37.8267608309957,
                "lng": 127.152680233021,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ì†¡íŒŒêµ¬ ì ì‹¤ë™ 40-1 ë¡¯ë°ì›”ë“œì‡¼í•‘ëª° ì§€í•˜1ì¸µ 1-73",
                "wins": 2,
                "lat": 37.5111038313694,
                "lng": 127.093918656887,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ì¤‘êµ¬ ë‚¨ëŒ€ë¬¸ë¡œ5ê°€ 12-5",
                "wins": 2,
                "lat": 37.3860144678258,
                "lng": 126.980930148662,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì¶©ë¶ ì²­ì£¼ì‹œ ìƒë‹¹êµ¬ ìœ¨ëŸ‰ë™ ìœ¨ëŸ‰ë™ 882-1",
                "wins": 2,
                "lat": 36.6689470045804,
                "lng": 127.488724533603,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼(ë§¤ê³¡ë™)",
                "address": "ê´‘ì£¼ ë¶êµ¬ ì„œí•˜ë¡œ 117 101í˜¸ (ë§¤ê³¡ë™)",
                "wins": 2,
                "lat": 35.1875664330488,
                "lng": 126.893374006345,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼ë™ì„±ì ",
                "address": "ì „ë‚¨ ìˆœì²œì‹œ ì—°í–¥ë²ˆì˜ê¸¸ 94 ë™ì„±ì•„íŒŒíŠ¸ ìƒê°€113í˜¸",
                "wins": 2,
                "lat": 34.9496505359864,
                "lng": 127.518470820555,
                "has_coords": true
            },
            {
                "name": "ì„œì°½ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ë‚¨ ì–‘ì‚°ì‹œ ì„œì°½ì„œ2ê¸¸ 3",
                "wins": 2,
                "lat": 35.4162007541456,
                "lng": 129.172241773542,
                "has_coords": true
            },
            {
                "name": "ìŠˆí¼ë³µê¶Œë‚˜ë¼",
                "address": "ë¶€ì‚° ì‚¬í•˜êµ¬ í•˜ë‹¨ë™ 590-7 GS25í¸ì˜ì ",
                "wins": 2,
                "lat": 35.1054424737126,
                "lng": 128.966552477705,
                "has_coords": true
            },
            {
                "name": "ìš´ì²œì (ë³µê¶Œë‚˜ë¼)",
                "address": "ê´‘ì£¼ ì„œêµ¬ ìŒì´Œë™ 876-14",
                "wins": 2,
                "lat": 35.146331779351,
                "lng": 126.856630513204,
                "has_coords": true
            },
            {
                "name": "í’í–¥ë™ë³µê¶Œë‚˜ë¼",
                "address": "ê´‘ì£¼ ë¶êµ¬ í’í–¥ë™ 581-15",
                "wins": 2,
                "lat": 35.1627074581564,
                "lng": 126.92826750498,
                "has_coords": true
            },
            {
                "name": "ê´‘ì–‘ë³µê¶Œë‚˜ë¼(ë¡œí„°ë¦¬)",
                "address": "ì „ë‚¨ ê´‘ì–‘ì‹œ ë°±ìš´ë¡œ 1",
                "wins": 1,
                "lat": 34.9712632148982,
                "lng": 127.589778883895,
                "has_coords": true
            },
            {
                "name": "ê´‘ì–‘ë³µê¶Œë‚˜ë¼(ë¡œí„°ë¦¬)",
                "address": "ì „ë‚¨ ê´‘ì–‘ì‹œ ê´‘ì–‘ì ë°±ìš´ë¡œ 1",
                "wins": 1,
                "lat": 34.9712632148982,
                "lng": 127.589778883895,
                "has_coords": true
            },
            {
                "name": "ë¡œë˜ë³µê¶Œë‚˜ë¼",
                "address": "ì „ë¶ ì •ìì‹œ ì—°ì§€ë™ 315-15",
                "wins": 1,
                "lat": 35.5739697093755,
                "lng": 126.845361369947,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì „ë‚¨ ì—¬ìˆ˜ì‹œ ì¤‘ì•™ë¡œ 62",
                "wins": 1,
                "lat": 34.7399319441762,
                "lng": 127.73434301317,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì „ë‚¨ ëª©í¬ì‹œ ë‹¹ê°€ë‘ë¡œ14ë²ˆê¸¸ 47-1 103í˜¸ ë³µê¶Œë‚˜ë¼",
                "wins": 1,
                "lat": 34.8075375629071,
                "lng": 126.437032140788,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì¶©ë¶ ì²­ì£¼ì‹œ ìƒë‹¹êµ¬ ìƒë‹¹ë¡œ 9",
                "wins": 1,
                "lat": 36.6291930748368,
                "lng": 127.491054146657,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ì¤‘ë‘êµ¬ ë´‰í™”ì‚°ë¡œ 30",
                "wins": 1,
                "lat": 37.6014405004367,
                "lng": 127.077566914738,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê°•ì› ì†ì´ˆì‹œ ì¤‘ì•™ë¡œ 28",
                "wins": 1,
                "lat": 38.1988927143669,
                "lng": 128.580261467148,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì „ë¶ êµ°ì‚°ì‹œ ë²ˆì˜ë¡œ 891",
                "wins": 1,
                "lat": 35.946539167222,
                "lng": 126.810357390789,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ëŒ€êµ¬ ë‹¬ì„±êµ° ë…¼ê³µì ë…¼ê³µì¤‘ì•™ë¡œ 106",
                "wins": 1,
                "lat": 35.7268184405189,
                "lng": 128.44766013498,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì¶©ë¶ ì œì²œì‹œ ì²­í’í˜¸ë¡œ 52",
                "wins": 1,
                "lat": 37.1265267151665,
                "lng": 128.202751056928,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ê¸° ìˆ˜ì›ì‹œ ì¥ì•ˆêµ¬ ì¥ì•ˆë¡œ 288 ìˆ˜ë‹¨ë€ì£¼ì ",
                "wins": 1,
                "lat": 37.3073855553469,
                "lng": 126.990337282378,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì¶©ë¶ ì²­ì£¼ì‹œ ì²­ì›êµ¬ ìœ¨ë´‰ë¡œ176ë²ˆê¸¸ 8-2",
                "wins": 1,
                "lat": 36.6685380944359,
                "lng": 127.488258400203,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ê¸° ê³ ì–‘ì‹œ ì¼ì‚°ë™êµ¬ í•˜ëŠ˜ë§ˆì„1ë¡œ 9 í•˜ëŠ˜ë§ˆì„4ë‹¨ì§€ 104í˜¸",
                "wins": 1,
                "lat": 37.6751521063689,
                "lng": 126.786516413064,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì¸ì²œ ë¯¸ì¶”í™€êµ¬ í† ê¸ˆë¶ë¡œ 47",
                "wins": 1,
                "lat": 37.4536176267821,
                "lng": 126.639337423492,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ë¶€ì‚° ì¤‘êµ¬ í•´ê´€ë¡œ 47-2",
                "wins": 1,
                "lat": 35.1031625223027,
                "lng": 129.035424136545,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ì¤‘ë‘êµ¬ ì¤‘í™”ë™ 312-1",
                "wins": 1,
                "lat": 37.6014163666359,
                "lng": 127.077547525141,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ê´€ì•…êµ¬ ë´‰ì²œë™ 926-25",
                "wins": 1,
                "lat": 37.4827911801255,
                "lng": 126.943494054423,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ê´‘ì§„êµ¬ êµ°ìë™ 66-3",
                "wins": 1,
                "lat": 37.5544014096211,
                "lng": 127.075616848966,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê°•ì› ì¶˜ì²œì‹œ í›„í‰ë™(í›„í‰2ë™) 687-20",
                "wins": 1,
                "lat": 37.8805353472471,
                "lng": 127.744962708671,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ê´€ì•…êµ¬ ë´‰ì²œë™(ì€ì²œë™) 941-18",
                "wins": 1,
                "lat": 37.4859980490674,
                "lng": 126.93984382336,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ì¤‘êµ¬ ë‚¨ëŒ€ë¬¸ë¡œ5ê°€(íšŒí˜„ë™) 21-1",
                "wins": 1,
                "lat": 37.5589629957983,
                "lng": 126.97492243505,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ë‚¨ ì°½ì›ì‹œ ì§„í•´êµ¬ ìš©ì›ë™ 1121-11 CUí¸ì˜ì  ë‚´",
                "wins": 1,
                "lat": 35.098502407655,
                "lng": 128.820837919735,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì¶©ë¶ ì²­ì£¼ì‹œ ì²­ì›êµ¬ ìœ¨ëŸ‰ë™ 912",
                "wins": 1,
                "lat": 36.6685077092537,
                "lng": 127.488240646242,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê°•ì› ì •ì„ êµ° ì •ì„ ì ë´‰ì–‘ë¦¬ 329-4",
                "wins": 1,
                "lat": 37.3796429509685,
                "lng": 128.662153004716,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì „ë¶ ì „ì£¼ì‹œ ì™„ì‚°êµ¬ ì‚¼ì²œë™1ê°€ 602-4",
                "wins": 1,
                "lat": 35.7978507945479,
                "lng": 127.117073008651,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ë™ì‘êµ¬ ìƒë„ë™ 370-27",
                "wins": 1,
                "lat": 37.5054198677438,
                "lng": 126.939823379761,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ê¸° ì•ˆì‚°ì‹œ ë‹¨ì›êµ¬ ì›ê³¡ë™ 801-4",
                "wins": 1,
                "lat": 37.3299241944505,
                "lng": 126.793629862924,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì¸ì²œ ì„œêµ¬ ë§ˆì „ë™(ê²€ë‹¨4ë™) 1029-5 ê²€ë‹¨2ì§€êµ¬59ë¸”ëŸ­ê²€ë‹¨1ì°¨í”¼ì˜¤ë ˆì•„íŒŒíŠ¸ìƒê°€Bë™ì œë¹„107í˜¸",
                "wins": 1,
                "lat": 35.2465193822099,
                "lng": 129.090849758352,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì¶©ë¶ ì²­ì£¼ì‹œ ìƒë‹¹êµ¬ ë‚¨ë¬¸ë¡œ1ê°€ 137-2",
                "wins": 1,
                "lat": 36.6292370815022,
                "lng": 127.491046487833,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê°•ì› ì •ì„ êµ° ì •ì„ ì ë´‰ì–‘ë¦¬ 329-6",
                "wins": 1,
                "lat": 37.3796234283135,
                "lng": 128.662029291295,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ëŒ€êµ¬ ë‹¬ì„±êµ° ë…¼ê³µì ë¶ë¦¬ 833-152",
                "wins": 1,
                "lat": 35.7268194688317,
                "lng": 128.447657059082,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê°•ì› ì¶˜ì²œì‹œ í›„í‰ë™ 687-1920",
                "wins": 1,
                "lat": 37.6049299589116,
                "lng": 126.907795976095,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ë¶€ì‚° ë™ë˜êµ¬ ëª…ì¥2ë™ 489-38",
                "wins": 1,
                "lat": 35.2101984563282,
                "lng": 129.104462088841,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ì†¡íŒŒêµ¬ ì‚¼ì „ë™ ì‚¼ì „ë™ 1751ì¸µë³µê¶Œë‚˜ë¼",
                "wins": 1,
                "lat": 35.8898860287954,
                "lng": 128.642631475541,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ëŒ€êµ¬ ë‹¬ì„±êµ° ë…¼ê³µì ë¶ë¦¬833-152",
                "wins": 1,
                "lat": 35.7268194688317,
                "lng": 128.447657059082,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ë¶€ì‚° ë™êµ¬ ë²”ì¼ë™ 44-13",
                "wins": 1,
                "lat": 35.1416650735539,
                "lng": 129.055351659393,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ê¸° ì˜ì™•ì‹œ ì‚¼ë™ 193-1",
                "wins": 1,
                "lat": 37.3206033999016,
                "lng": 126.949824091213,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê°•ì› ì›ì£¼ì‹œ ì¤‘ì•™ë™ 151-5",
                "wins": 1,
                "lat": 37.3488674783205,
                "lng": 127.952665771774,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì „ë‚¨ ì—¬ìˆ˜ì‹œ êµë™ 448-1",
                "wins": 1,
                "lat": 34.7399191658559,
                "lng": 127.734399245065,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê°•ì› ì†ì´ˆì‹œ êµë™ 645-45",
                "wins": 1,
                "lat": 38.2008976812592,
                "lng": 128.582406520618,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê´‘ì£¼ ë¶êµ¬ ìš©ë´‰ë™ 1251-16",
                "wins": 1,
                "lat": 35.1776727781232,
                "lng": 126.900893531378,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ê´‘ì§„êµ¬ ì¤‘ê³¡ë™ 341-5",
                "wins": 1,
                "lat": 37.5569331088627,
                "lng": 127.08198202499,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ê´€ì•…êµ¬ ë´‰ì²œë³¸ë™ 926-25",
                "wins": 1,
                "lat": 37.4827911801255,
                "lng": 126.943494054423,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì¸ì²œ ë‚¨êµ¬ ìš©í˜„ë™ 611-1",
                "wins": 1,
                "lat": 37.4534408705648,
                "lng": 126.639078893857,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì „ë‚¨ ëª©í¬ì‹œ ìš©í•´ë™ 718-4",
                "wins": 1,
                "lat": 34.8135223020167,
                "lng": 126.399531402172,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê°•ì› ì›ì£¼ì‹œ í•™ì„±ë™ 436-15",
                "wins": 1,
                "lat": 37.3559804816736,
                "lng": 127.943933258247,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ë¶ ê²½ì‚°ì‹œ ì‚¼ë‚¨ë™ 132-4",
                "wins": 1,
                "lat": 35.8145916169308,
                "lng": 128.738666649634,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ê°•ì„œêµ¬ ë“±ì´Œ1ë™ 654-44",
                "wins": 1,
                "lat": 37.5550163344576,
                "lng": 126.855910019959,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼(ê°€ì¢Œì‚¬)",
                "address": "ì¸ì²œ ì„œêµ¬ ì›ì ë¡œ 73",
                "wins": 1,
                "lat": 37.4936571016794,
                "lng": 126.680615310851,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼(ë“¤ì•ˆê¸¸)",
                "address": "ëŒ€êµ¬ ìˆ˜ì„±êµ¬ ì¤‘ë™ 133-3",
                "wins": 1,
                "lat": 35.8446831111501,
                "lng": 128.616335645917,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼(ì¤‘í¥ì )",
                "address": "ê´‘ì£¼ ë¶êµ¬ ìš°ì¹˜ë¡œ 26-1",
                "wins": 1,
                "lat": 37.470482,
                "lng": 126.6383959,
                "has_coords": true
            },
            {
                "name": "ë³µê¶Œë‚˜ë¼ë™ì„±ì ",
                "address": "ì „ë‚¨ ìˆœì²œì‹œ ì—°í–¥ë™ 1347ë™ì„±ì•„íŒŒíŠ¸ ìƒê°€113í˜¸",
                "wins": 1,
                "lat": 34.9501004690263,
                "lng": 127.518922282928,
                "has_coords": true
            },
            {
                "name": "ì„œì°½ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ë‚¨ ì–‘ì‚°ì‹œ ì‚¼í˜¸ë™ 528-1",
                "wins": 1,
                "lat": 35.4162015083399,
                "lng": 129.172239922477,
                "has_coords": true
            },
            {
                "name": "ìˆ˜í¼ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ë‚¨ ê¹€í•´ì‹œ ìœ¨í•˜ë™ 1352-1 101í˜¸ ë³µê¶ŒíŒë§¤ì ",
                "wins": 1,
                "lat": 35.172796348886,
                "lng": 128.815637664775,
                "has_coords": true
            },
            {
                "name": "ìŠˆí¼ë³µê¶Œë‚˜ë¼",
                "address": "ë¶€ì‚° ë¶€ì‚°ì§„êµ¬ ê°€ì•¼ë™(ê°€ì•¼ì œ1ë™) 377-10",
                "wins": 1,
                "lat": 35.1546084194796,
                "lng": 129.037430885391,
                "has_coords": true
            },
            {
                "name": "ìŠˆí¼ë³µê¶Œë‚˜ë¼",
                "address": "ë¶€ì‚° ë¶€ì‚°ì§„êµ¬ ê°€ì•¼ë™ 377-10GS25ê°€ì•¼ì  ë‚´",
                "wins": 1,
                "lat": 35.1546084194796,
                "lng": 129.037430885391,
                "has_coords": true
            },
            {
                "name": "ìŠˆí¼ë³µê¶Œë‚˜ë¼",
                "address": "ë¶€ì‚° ì‚¬í•˜êµ¬ í•˜ë‹¨ë™ 590-7",
                "wins": 1,
                "lat": 35.1054424737126,
                "lng": 128.966552477705,
                "has_coords": true
            },
            {
                "name": "ìŠˆí¼ë³µê¶Œë‚˜ë¼",
                "address": "ë¶€ì‚° ë¶€ì‚°ì§„êµ¬ ë²”ì²œë™ 845-95",
                "wins": 1,
                "lat": 35.1428303887418,
                "lng": 129.061088856564,
                "has_coords": true
            },
            {
                "name": "ìŠˆí¼ë³µê¶Œë‚˜ë¼ìˆ˜ì •ì ",
                "address": "ë¶€ì‚° ë™êµ¬ ìˆ˜ì •1ë™ 309-7",
                "wins": 1,
                "lat": 36.8778493127528,
                "lng": 126.8982919075,
                "has_coords": true
            },
            {
                "name": "ìŠˆí¼ë³µê¶Œë‚˜ë¼ìˆ˜ì •ì ",
                "address": "ë¶€ì‚° ë™êµ¬ ìˆ˜ì •1ë™ 312-7",
                "wins": 1,
                "lat": 37.5798141316398,
                "lng": 127.045949088013,
                "has_coords": true
            },
            {
                "name": "ì‹ ë‚˜ë¼ë³µê¶Œë‚˜ë¼",
                "address": "ì„œìš¸ ë™ëŒ€ë¬¸êµ¬ ì´ë¬¸ë™(ì´ë¬¸ì œ1ë™) 258-51",
                "wins": 1,
                "lat": 37.6000811172932,
                "lng": 127.062138467607,
                "has_coords": true
            },
            {
                "name": "ì‹¬ë´¤ë‹¤ë³µê¶Œë‚˜ë¼",
                "address": "ëŒ€êµ¬ ë¶êµ¬ ì¹¨ì‚°ë™ 826",
                "wins": 1,
                "lat": 35.9006546548689,
                "lng": 128.585678483802,
                "has_coords": true
            },
            {
                "name": "ì¢…í•©ë³µê¶Œë‚˜ë¼",
                "address": "ê°•ì› ì›ì£¼ì‹œ ë‚¨ì›ë¡œ 619",
                "wins": 1,
                "lat": 37.338522505806,
                "lng": 127.951433962212,
                "has_coords": true
            },
            {
                "name": "ì¢…í•©ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ê¸° ì–‘í‰êµ° ì–‘í‰ì ì–‘ê·¼ë¦¬ ì–‘ê·¼ë¦¬ 176-14",
                "wins": 1,
                "lat": 37.4905296761419,
                "lng": 127.495935182678,
                "has_coords": true
            },
            {
                "name": "íŒŒì›Œë§ˆíŠ¸ ë³µê¶Œë‚˜ë¼",
                "address": "ê´‘ì£¼ ë¶êµ¬ ìš´ì•”ë™ 252 1ì¸µ 13í˜¸ íŒŒì›Œë§ˆíŠ¸ë‚´",
                "wins": 1,
                "lat": 35.1819754303627,
                "lng": 126.876854779113,
                "has_coords": true
            },
            {
                "name": "í‰ì°½ë³µê¶Œë‚˜ë¼",
                "address": "ê°•ì› í‰ì°½êµ° í‰ì°½ì í•˜ë¦¬ 148-13",
                "wins": 1,
                "lat": 37.367639494599,
                "lng": 128.395066869892,
                "has_coords": true
            },
            {
                "name": "í’í–¥ë™ë³µê¶Œë‚˜ë¼",
                "address": "ê´‘ì£¼ ë¶êµ¬ í’í–¥ë™ 581-19",
                "wins": 1,
                "lat": 35.1628241204059,
                "lng": 126.927856566903,
                "has_coords": true
            },
            {
                "name": "í•™ë™ë³µê¶Œë‚˜ë¼",
                "address": "ì „ë‚¨ ì—¬ìˆ˜ì‹œ í•™ë™ 69-2",
                "wins": 1,
                "lat": 34.7635264403985,
                "lng": 127.663447941462,
                "has_coords": true
            },
            {
                "name": "í•´ë“ ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ê¸° ë¶€ì²œì‹œ ì†Œí–¥ë¡œ 239 ëŒ€ì•¼í•˜ì´ë¹Œíˆ¬ 106í˜¸",
                "wins": 1,
                "lat": 37.5008571918308,
                "lng": 126.774349625251,
                "has_coords": true
            },
            {
                "name": "í•´ë“ ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ê¸° ë¶€ì²œì‹œ ì›ë¯¸êµ¬ ì¤‘ë™ ì¤‘ë™ 1152 1ì¸µ 109í˜¸ ì˜ˆìŠ¤25ì‹œí¸ì˜ì ë‚´",
                "wins": 1,
                "lat": 37.5015569512805,
                "lng": 126.769055278574,
                "has_coords": true
            },
            {
                "name": "í–‰ìš´ë³µê¶Œë‚˜ë¼",
                "address": "ì „ë‚¨ ê´‘ì–‘ì‹œ ëŒ€ë¦¼ì˜¤ì„±ë¡œ 146-1",
                "wins": 1,
                "lat": 34.9647592140868,
                "lng": 127.577753154758,
                "has_coords": true
            },
            {
                "name": "í™©ê¸ˆëŒ€ë°•ë³µê¶Œë‚˜ë¼",
                "address": "ê²½ê¸° ìš©ì¸ì‹œ ì²˜ì¸êµ¬ ê¹€ëŸ‰ì¥ë™ 133-200",
                "wins": 1,
                "lat": 37.2367932618193,
                "lng": 127.205772836216,
                "has_coords": true
            }

        ];
        let registeredKeys = JSON.parse(localStorage.getItem('pov_registered_shops') || '[]');

        document.addEventListener('DOMContentLoaded', init);

        async function init() {
            try {
                // Initialize Map
                if (typeof kakao !== 'undefined' && kakao.maps) {
                    const mapContainer = document.getElementById('map');
                    const mapOption = { center: new kakao.maps.LatLng(37.4815, 127.0145), level: 3 };
                    map = new kakao.maps.Map(mapContainer, mapOption);

                    const rvContainer = document.getElementById('roadview');
                    rv = new kakao.maps.Roadview(rvContainer);
                    rvClient = new kakao.maps.RoadviewClient();

                    marker = new kakao.maps.Marker({
                        position: map.getCenter(),
                        map: map,
                        draggable: true
                    });

                    // Roadview Events
                    kakao.maps.event.addListener(rv, 'init', updatePOVUI);
                    kakao.maps.event.addListener(rv, 'viewpoint_changed', updatePOVUI);
                    kakao.maps.event.addListener(rv, 'position_changed', updatePOVUI);

                    // Map Marker Events
                    kakao.maps.event.addListener(marker, 'dragend', function () {
                        const pos = marker.getPosition();
                        loadRoadview(pos.getLat(), pos.getLng());
                    });

                    // Manual Input Events
                    ['rv-pan', 'rv-tilt', 'rv-zoom'].forEach(id => {
                        document.getElementById(id).addEventListener('input', applyPOV);
                    });
                } else {
                    console.warn('Kakao SDK not loaded, map features disabled.');
                    document.getElementById('status-text').innerText = 'ì§€ë„ SDK ë¡œë“œ ì‹¤íŒ¨ (ë¦¬ìŠ¤íŠ¸ëŠ” í™•ì¸ ê°€ëŠ¥)';
                }
            } catch (err) {
                console.error('Error during init:', err);
                document.getElementById('status-text').innerText = 'ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ (ë¦¬ìŠ¤íŠ¸ëŠ” í™•ì¸ ê°€ëŠ¥)';
            }

            // Render the list always
            renderShopList();
        }

        function renderShopList() {
            // Filter out registered shops
            const filteredList = allMissingShops.filter(shop => {
                const key = `${shop.name}|${shop.address}`;
                return !registeredKeys.includes(key);
            });

            document.getElementById('missing-count').innerText = filteredList.length;
            document.getElementById('status-text').innerText = `ë‚¨ì€ ëŒ€ìƒ: ${filteredList.length}ê°œ / ì „ì²´: ${allMissingShops.length}ê°œ`;

            const listContainer = document.getElementById('shop-list');
            listContainer.innerHTML = '';

            filteredList.forEach((shop, index) => {
                const div = document.createElement('div');
                div.className = 'shop-item';
                if (currentShop && currentShop.name === shop.name && currentShop.address === shop.address) {
                    div.classList.add('active');
                }
                div.innerHTML = `
                    <div class="shop-name">${shop.name}</div>
                    <div class="shop-addr">${shop.address}</div>
                    <div class="win-count">${shop.wins}íšŒ ë‹¹ì²¨</div>
                `;
                div.onclick = () => selectShop(shop, div);
                listContainer.appendChild(div);
            });

            if (filteredList.length === 0 && allMissingShops.length > 0) {
                listContainer.innerHTML = '<div style="padding:20px; text-align:center; color:#666;">ğŸ‰ ëª¨ë“  ìƒì ì˜ ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
            }
        }

        function selectShop(shop, element) {
            document.querySelectorAll('.shop-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            currentShop = shop;

            const moveLatLon = new kakao.maps.LatLng(shop.lat, shop.lng);
            map.setCenter(moveLatLon);
            marker.setPosition(moveLatLon);

            loadRoadview(shop.lat, shop.lng);
        }

        function loadRoadview(lat, lng) {
            const position = new kakao.maps.LatLng(lat, lng);
            rvClient.getNearestPanoId(position, 100, function (panoId) {
                if (panoId) {
                    rv.setPanoId(panoId, position);
                } else {
                    alert('ë°˜ê²½ 100m ì´ë‚´ì— ë¡œë“œë·° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
            });
        }

        function updatePOVUI() {
            if (!rv.getPanoId()) return;

            const panoId = rv.getPanoId();
            const viewpoint = rv.getViewpoint();
            const position = rv.getPosition();

            document.getElementById('rv-pano').value = panoId;
            document.getElementById('rv-pan').value = viewpoint.pan.toFixed(2);
            document.getElementById('rv-tilt').value = viewpoint.tilt.toFixed(2);
            document.getElementById('rv-zoom').value = viewpoint.zoom;

            if (position) {
                document.getElementById('cur-lat').value = position.getLat().toFixed(6);
                document.getElementById('cur-lng').value = position.getLng().toFixed(6);
            }

            updateCodeOutput();
        }

        function applyPOV() {
            const pan = parseFloat(document.getElementById('rv-pan').value);
            const tilt = parseFloat(document.getElementById('rv-tilt').value);
            const zoom = parseInt(document.getElementById('rv-zoom').value);

            if (!isNaN(pan) && !isNaN(tilt)) {
                rv.setViewpoint({ pan, tilt, zoom });
            }
        }

        function syncMapToRV() {
            const pos = rv.getPosition();
            if (pos) {
                map.setCenter(pos);
                marker.setPosition(pos);
            }
        }

        function updateCodeOutput() {
            if (!currentShop) return;

            const panoId = rv.getPanoId();
            const vp = rv.getViewpoint();

            const addr = currentShop.address;
            const code = `{ name: "${currentShop.name}", addr: "${addr}", panoId: ${panoId}, pov: { pan: ${vp.pan.toFixed(2)}, tilt: ${vp.tilt.toFixed(2)}, zoom: ${vp.zoom} } },`;
            document.getElementById('code-output').innerText = code;
        }

        function copyCode() {
            const text = document.getElementById('code-output').innerText;
            if (text.startsWith('//')) return;
            navigator.clipboard.writeText(text).then(() => {
                alert('ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            });
        }

        function markAsRegistered() {
            if (!currentShop) {
                alert('ë¨¼ì € ìƒì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const key = `${currentShop.name}|${currentShop.address}`;
            if (!registeredKeys.includes(key)) {
                registeredKeys.push(key);
                localStorage.setItem('pov_registered_shops', JSON.stringify(registeredKeys));
                alert(`'${currentShop.name}' ìƒì ì´ ë“±ë¡ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                currentShop = null;
                renderShopList();
                document.getElementById('code-output').innerText = '// ìƒì ì„ ì„ íƒí•´ì£¼ì„¸ìš”';
            }
        }

        function resetRegistered() {
            if (confirm('ëª¨ë“  ë“±ë¡ ì™„ë£Œ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì‚­ì œëœ ë¦¬ìŠ¤íŠ¸ê°€ ë‹¤ì‹œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤)')) {
                registeredKeys = [];
                localStorage.removeItem('pov_registered_shops');
                renderShopList();
            }
        }
    </script>
</body>

</html>