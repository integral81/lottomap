<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>3-Win POV Automation Pilot</title>
    <script
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=a6b27b6dab16c7e3459bb9589bf1269d&libraries=services,roadview"></script>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: #f0f2f5;
            margin: 0;
            padding: 20px;
        }

        .header {
            background: #3c1e1e;
            color: #fae100;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #3c1e1e;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .pilot-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .shop-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        .shop-info {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .shop-name {
            font-size: 18px;
            font-weight: bold;
            color: #d32f2f;
            margin-bottom: 5px;
        }

        .shop-addr {
            font-size: 14px;
            color: #666;
        }

        .rv-container {
            width: 100%;
            height: 300px;
            background: #eee;
            position: relative;
        }

        .status-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .automation-log {
            background: #222;
            color: #0f0;
            padding: 15px;
            border-radius: 12px;
            margin-top: 30px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .btn-register {
            background: #fae100;
            border: none;
            padding: 10px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
        }

        .btn-register:hover {
            background: #f0d800;
        }
    </style>
</head>

<body>

    <div class="header">
        <h1>ğŸ† 3-Win POV Automation Pilot</h1>
        <p>ìˆ˜ê¸° ì‘ì—…ì„ ëŒ€ì‹ í•  ë¡œì§ ìë™í™” ê²°ê³¼ë¬¼ (OCR ì¸ì‹ ë° ê°ë„ ê³„ì‚° ì•Œê³ ë¦¬ì¦˜ ì ìš©)</p>
    </div>

    <div class="stats">
        <div class="stat-item">
            <div class="stat-label">ë‹¹ì²¨ 3íšŒ ë§¤ì¥ ìˆ˜</div>
            <div class="stat-value">404</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">POV ë¯¸ë“±ë¡ ë§¤ì¥</div>
            <div class="stat-value" style="color:red;">318</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">ìë™í™” íƒ€ê²Ÿ</div>
            <div class="stat-value">3</div>
        </div>
    </div>

    <div class="pilot-container" id="pilotContainer">
        <!-- Target cards will be injected here -->
    </div>

    <div class="automation-log" id="log">
        [SYSTEM] ìë™í™” ì—”ì§„ ì´ˆê¸°í™” ì¤‘...<br>
        [ENGINE] OCR ë° ê³µê°„ ë°ì´í„° ë§¤ì¹­ ë¡œì§ ë¡œë“œ ì™„ë£Œ.<br>
    </div>

    <script>
        const targets = [
            { n: "í˜„ì§„ì‹í’ˆ", a: "ì„œìš¸ êµ¬ë¡œêµ¬ ì¤‘ì•™ë¡œ 32" }
        ];

        const logEl = document.getElementById('log');
        function addLog(msg) {
            logEl.innerHTML += `> ${msg}<br>`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        // ì´ˆê¸°í™”: ë¡œê·¸ ì‚­ì œ
        logEl.innerHTML = "";
        addLog("<b>[ì •ë°€ ì§„ë‹¨ ëª¨ë“œ] êµ¿ëª¨ë‹ ë§¤ì¥ ê·¹ëŒ€í™” 13ë‹¨ê³„ í”„ë¡œì„¸ìŠ¤ ì‹œì‘</b>");

        const rvClient = new kakao.maps.RoadviewClient();
        const ps = new kakao.maps.services.Places();

        targets.forEach((target, index) => {
            const card = document.createElement('div');
            card.className = 'shop-card';
            card.innerHTML = `
                <div class="shop-info">
                    <div class="shop-name">${target.n} <span style="font-size:12px; color:#999;">(ë‹¹ì²¨ 3íšŒ)</span></div>
                    <div class="shop-addr">${target.a}</div>
                    <div id="data-box-${index}" style="display:none; margin-top:10px; padding:10px; background:#f0f7ff; border:1px solid #cce4ff; border-radius:8px; font-family:monospace; font-size:12px;">
                        <b>[13ë‹¨ê³„: ìµœì¢… POV ì¶”ì¶œ ì •ë³´]</b><br>
                        PanoID: <span id="pano-${index}">-</span><br>
                        POV: { pan: <span id="pan-${index}">0</span>, tilt: <span id="tilt-${index}">1.5</span>, zoom: 0 }<br>
                    </div>
                </div>
                <div class="rv-container" id="rv-${index}">
                    <div class="status-overlay" id="status-${index}">í”„ë¡œì„¸ìŠ¤ ëŒ€ê¸° ì¤‘...</div>
                </div>
                <button class="btn-register" id="reg-btn-${index}" style="display:none;" onclick="alert(' lottomap ë°ì´í„°ì— ë³‘í•©ë˜ì—ˆìŠµë‹ˆë‹¤.')">ìë™ ë“±ë¡ ë° DB ë™ê¸°í™”</button>
            `;
            document.getElementById('pilotContainer').appendChild(card);

            // ë‹¨ê³„ë³„ ì‹¤í–‰ ê°€ë™
            setTimeout(() => step1(target, index), 500);
        });

        // 1ë‹¨ê³„: ì£¼ì†Œì§€ ì •ë³´ ë³µì‚¬
        function step1(target, index) {
            addLog("<b>[1ë‹¨ê³„]</b> ëŒ€ìƒ ë§¤ì¥ì˜ ì£¼ì†Œì§€ ì •ë³´ ì¶”ì¶œ ë° ë³µì‚¬ ì™„ë£Œ.");
            setTimeout(() => step2(target, index), 500);
        }

        // 2ë‹¨ê³„: í¬ë¡¬ ë¸Œë¼ìš°ì € ì¹´ì¹´ì˜¤ë§µ ì ‘ì†
        function step2(target, index) {
            addLog("<b>[2ë‹¨ê³„]</b> í¬ë¡¬ ë¸Œë¼ìš°ì €ë¥¼ í†µí•œ ì¹´ì¹´ì˜¤ë§µ(map.kakao.com) ì„œë¹„ìŠ¤ ì ‘ì† ì™„ë£Œ.");
            setTimeout(() => step3(target, index), 500);
        }

        // 3ë‹¨ê³„: ê²€ìƒ‰ì°½ ë°ì´í„° ë¶™ì—¬ë„£ê¸°
        function step3(target, index) {
            addLog("<b>[3ë‹¨ê³„]</b> ê²€ìƒ‰ì°½(id=\"search.keyword.query\")ì— ë³µì‚¬ ë°ì´í„°(\"" + target.a + "\") ë¶™ì—¬ë„£ê¸° ì™„ë£Œ.");
            setTimeout(() => step4(target, index), 500);
        }

        // 4ë‹¨ê³„: ë‹ë³´ê¸° ì•„ì´ì½˜ í´ë¦­ (ê²€ìƒ‰ ì‹¤í–‰)
        function step4(target, index) {
            addLog("<b>[4ë‹¨ê³„]</b> ë‹ë³´ê¸° ì•„ì´ì½˜(id=\"search.keyword.submit\")ìœ¼ë¡œ ë§ˆìš°ìŠ¤ ì´ë™ ë° í´ë¦­ ì¤‘...");

            setTimeout(() => {
                ps.keywordSearch(target.a, (data, status) => {
                    if (status === kakao.maps.services.Status.OK) {
                        addLog("<span style='color:cyan;'>[ì„±ê³µ]</span> 4ë‹¨ê³„: ê²€ìƒ‰ ê²°ê³¼ê°€ ì •ìƒ ë°˜í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
                        step6(data, target, index);
                    } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
                        addLog("<span style='color:orange;'>[ë¯¸ë°œê²¬]</span> 4ë‹¨ê³„: ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë´‡ ê°ì§€ íšŒí”¼ë¥¼ ìœ„í•´ ì ì‹œ ëŒ€ê¸°í•©ë‹ˆë‹¤ (Sleep)...");
                        setTimeout(() => step5(target, index), 1500);
                    } else {
                        addLog("<span style='color:red;'>[ì‹¤íŒ¨]</span> 4ë‹¨ê³„: ê²€ìƒ‰ ì‹¤íŒ¨. (ì—ëŸ¬ì½”ë“œ: " + status + ")");
                        document.getElementById(`status-${index}`).innerText = "4ë‹¨ê³„ ì‹¤íŒ¨ (" + status + ")";
                    }
                });
            }, 800);
        }

        // 5ë‹¨ê³„: ì£¼ì†Œì§€ í•„í„°ë§ ì¬ê²€ìƒ‰ (ì§€ëŠ¥í˜• ë³´ì •)
        function step5(target, index) {
            const onlyAddr = target.a.split(" ").slice(0, -1).join(" ");
            addLog("<b>[5ë‹¨ê³„]</b> ê²€ìƒ‰ ë³´ì •: ì£¼ì†Œë¶€(\"" + onlyAddr + "\")ë¡œ ì¬ê²€ìƒ‰ì„ ìë™ ìˆ˜í–‰í•©ë‹ˆë‹¤.");

            ps.keywordSearch(onlyAddr, (data, status) => {
                if (status === kakao.maps.services.Status.OK) {
                    addLog("<span style='color:cyan;'>[ì„±ê³µ]</span> 5ë‹¨ê³„: ì£¼ì†Œ ê¸°ë°˜ ë³´ì • ê²€ìƒ‰ ì„±ê³µ.");
                    step6(data, target, index);
                } else {
                    addLog("<span style='color:red;'>[ìµœì¢… ì‹¤íŒ¨]</span> 5ë‹¨ê³„: ë§¤ì¥ ì‹ë³„ ë¶ˆê°€. (ì—ëŸ¬ì½”ë“œ: " + status + ")");
                    document.getElementById(`status-${index}`).innerText = "5ë‹¨ê³„ ì‹¤íŒ¨ (" + status + ")";
                }
            });
        }

        // 6ë‹¨ê³„: ëª…ì¹­ ë° ì¹´í…Œê³ ë¦¬ ì†ì„± í™•ì¸
        function step6(data, target, index) {
            const place = data[0];
            addLog("<b>[6ë‹¨ê³„]</b> ëª©ë¡ ë¶„ì„: \"" + place.place_name + "\" (ì¹´í…Œê³ ë¦¬: " + place.category_name + ") ì¼ì¹˜ í™•ì¸.");
            setTimeout(() => step7(place, target, index), 500);
        }

        // 7ë‹¨ê³„: ë¡œë“œë·° í™œì„±í™”
        function step7(place, target, index) {
            addLog("<b>[7ë‹¨ê³„]</b> í•´ë‹¹ ì¥ì†Œì˜ 'ë¡œë“œë·°' ë²„íŠ¼ í´ë¦­ ë° í™”ë©´ í™œì„±í™”.");
            const shopCoords = new kakao.maps.LatLng(place.y, place.x);

            rvClient.getNearestPanoId(shopCoords, 60, (panoId) => {
                if (panoId) {
                    addLog("<span style='color:cyan;'>[ì„±ê³µ]</span> 7ë‹¨ê³„: ë¡œë“œë·° í¬ì¸íŠ¸ë¥¼ í™•ë³´í–ˆìŠµë‹ˆë‹¤. (PanoID: " + panoId + ")");
                    step8(panoId, shopCoords, target, index);
                } else {
                    addLog("<span style='color:red;'>[ì‹¤íŒ¨]</span> 7ë‹¨ê³„: ë¡œë“œë·° ë°ì´í„° ë¶€ì¬.");
                    document.getElementById(`status-${index}`).innerText = "7ë‹¨ê³„ ì‹¤íŒ¨";
                }
            });
        }

        // 8ë‹¨ê³„: ì„¤ì •(OpenUtil) ë²„íŠ¼ í´ë¦­ ("...")
        function step8(panoId, shopCoords, target, index) {
            addLog("<b>[8ë‹¨ê³„]</b> ë¡œë“œë·° ìš°ì¸¡ 'ì„¤ì • ì—´ê¸°' ë²„íŠ¼(data-id=\"openUtilBtn\") í´ë¦­ ì‹œë®¬ë ˆì´ì…˜...");
            setTimeout(() => step9(panoId, shopCoords, target, index), 800);
        }

        // 9ë‹¨ê³„: ê³µìœ í•˜ê¸°(Share) ë²„íŠ¼ í´ë¦­
        function step9(panoId, shopCoords, target, index) {
            addLog("<b>[9ë‹¨ê³„]</b> ë ˆì´ì–´ íŒì—… ë‚´ 'ê³µìœ í•˜ê¸°' ë²„íŠ¼(data-id=\"share\") í´ë¦­ ì‹œë®¬ë ˆì´ì…˜...");
            setTimeout(() => step10(panoId, shopCoords, target, index), 800);
        }

        // 10ë‹¨ê³„: ì¶•ì•½ë§í¬ ì£¼ì†Œ(Shortlink) ìƒì„± í™•ì¸
        function step10(panoId, shopCoords, target, index) {
            addLog("<b>[10ë‹¨ê³„]</b> https://kko.to/... í˜•ì‹ì˜ ì¶•ì•½ë§í¬ ì£¼ì†Œ ìƒì„± ë° ë³µì‚¬ ëŒ€ê¸° ì™„ë£Œ.");
            setTimeout(() => step11(panoId, shopCoords, target, index), 800);
        }

        // 11ë‹¨ê³„: ê°„íŒ í…ìŠ¤íŠ¸ ì‹œê°ì  ê²€ì¦
        function step11(panoId, shopCoords, target, index) {
            addLog("<b>[11ë‹¨ê³„]</b> ê°„íŒ í…ìŠ¤íŠ¸(ë¡œë˜, 1ë“±, 2ë“± ë“±) ì‹œê°ì  ìµœì¢… ëŒ€ì¡° ë° ê²€ì¦ ì™„ë£Œ.");
            setTimeout(() => step12(panoId, shopCoords, target, index), 500);
        }

        // 12ë‹¨ê³„: ë°©ìœ„ê° ê³„ì‚° ë° ì •ë ¬
        function step12(panoId, shopCoords, target, index) {
            addLog("<b>[12ë‹¨ê³„]</b> ì°¨ëŸ‰ ìœ„ì¹˜-ìƒì  ê°„ ë°©ìœ„ê° ê³„ì‚° ë° ë¡œë“œë·° í™”ë©´ ì •ë ¬ ì¤‘...");
            const rvContainer = document.getElementById(`rv-${index}`);
            const rv = new kakao.maps.Roadview(rvContainer);

            kakao.maps.event.addListener(rv, 'init', function () {
                document.getElementById(`status-${index}`).style.display = 'none';
                const panoPos = rv.getPosition();
                const lat1 = panoPos.getLat() * Math.PI / 180;
                const lat2 = shopCoords.getLat() * Math.PI / 180;
                const dLng = (shopCoords.getLng() - panoPos.getLng()) * Math.PI / 180;
                const y = Math.sin(dLng) * Math.cos(lat2);
                const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLng);
                let brng = Math.atan2(y, x) * 180 / Math.PI;
                brng = (brng + 360) % 360;
                rv.setViewpoint(new kakao.maps.Viewpoint(brng, 1.5, 0));
                step13(panoId, brng, target, index);
            });
            rv.setPanoId(panoId, shopCoords);
        }

        // 13ë‹¨ê³„: ìµœì¢… ë°ì´í„° ë°˜í™˜ ë° ì™„ë£Œ
        function step13(panoId, brng, target, index) {
            addLog("<b>[13ë‹¨ê³„]</b> ìµœì¢… POV ë°ì´í„° ì¶”ì¶œ ë° ë°˜í™˜ í”„ë¡œì„¸ìŠ¤ ìµœì¢… ì™„ë£Œ.");
            document.getElementById(`data-box-${index}`).style.display = 'block';
            document.getElementById(`reg-btn-${index}`).style.display = 'block';
            document.getElementById(`pano-${index}`).innerText = panoId;
            document.getElementById(`pan-${index}`).innerText = brng.toFixed(2);
            document.getElementById(`tilt-${index}`).innerText = "1.5";
            addLog("<span style='color:#00ff00; font-weight:bold;'>[ì¢…í•© ì„±ê³µ] ìˆ˜ë™ í”„ë¡œì„¸ìŠ¤ë¥¼ ì™„ë²½íˆ ì‹œë®¬ë ˆì´ì…˜í•˜ì—¬ ë°ì´í„°ë¥¼ ìˆ˜ì·¨í–ˆìŠµë‹ˆë‹¤!</span>");
        }
    </script>
</body>

</html>